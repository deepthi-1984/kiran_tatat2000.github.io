<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Product Detail</title>

  <!-- Google tag (GA4) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-QZP4DFQ5V1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-QZP4DFQ5V1');
  </script>
</head>

<body>
  <h1>Product Detail</h1>

  <p id="product-name">Sample Product</p>
  <p>Price: $499</p>

  <button id="add-to-cart">Add to Cart</button>
  <br><br>
  <a href="cart.html">Go to Cart</a>

  <script>
    function getProductId() {
      const params = new URLSearchParams(window.location.search);
      return params.get('product_id');
    }

    const productId = getProductId() || 'unknown_id';
    const productName = document.getElementById("product-name").innerText;

    // Or better, check if it exists before firing the event
  if (productId) {
    gtag('event', 'view_item', {
      currency: 'USD',
      value: 499,
      items: [{
        item_id: productId,
        item_name: productName,
        price: 499
      }]
    });
}

    // Fire view_item AFTER everything exists
    gtag('event', 'view_item', {
      currency: 'USD',
      value: 499,
      items: [{
        item_id: productId,
        item_name: productName,
        price: 499
      }]
    });

    document.getElementById("add-to-cart").addEventListener("click", function () {
      gtag('event', 'add_to_cart', {
        currency: 'USD',
        value: 499,
        items: [{
          item_id: productId,
          item_name: productName,
          price: 499
        }]
      });
    });
  </script>
</body>
</html>

